services:
  gateway:
    build:
      context: ../..
      dockerfile: deployments/docker/gateway.Dockerfile
    ports:
      - "8080:8080"
    environment:
      - GATEWAY_PORT=8080
      - ASR_ADDRESS=asr:50051
      - TRANSLATOR_ADDRESS=translator:50052
      - TTS_ADDRESS=tts:50053
      - LOG_LEVEL=info
    depends_on:
      - asr
      - translator
      - tts
    restart: unless-stopped

  asr:
    build:
      context: ../..
      dockerfile: deployments/docker/asr.Dockerfile
    ports:
      - "50051:50051"
    environment:
      - ASR_PORT=50051
      - GOOGLE_APPLICATION_CREDENTIALS=/credentials/gcp-credentials.json
      - LOG_LEVEL=info
    volumes:
      - ${GCP_CREDENTIALS_PATH:-./credentials}:/credentials:ro
    restart: unless-stopped

  translator:
    build:
      context: ../..
      dockerfile: deployments/docker/translator.Dockerfile
    ports:
      - "50052:50052"
    environment:
      - TRANSLATOR_PORT=50052
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - LOG_LEVEL=info
    restart: unless-stopped

  tts:
    build:
      context: ../..
      dockerfile: deployments/docker/tts.Dockerfile
    ports:
      - "50053:50053"
    environment:
      - TTS_PORT=50053
      - GOOGLE_APPLICATION_CREDENTIALS=/credentials/gcp-credentials.json
      - LOG_LEVEL=info
    volumes:
      - ${GCP_CREDENTIALS_PATH:-./credentials}:/credentials:ro
    restart: unless-stopped

networks:
  default:
    driver: bridge
